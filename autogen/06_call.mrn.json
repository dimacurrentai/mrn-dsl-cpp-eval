{
  "src": "06_call.mrn",
  "maroon": {
    "call_dump": {
      "line": 27,
      "fibers": {
        "call": {
          "line": 28,
          "functions": {
            "inner": {
              "line": 45,
              "body": {
                "line": 45,
                "vars": [
                  {
                    "line": 46,
                    "name": "b",
                    "type": "TODO(dkorolev): Implement this.",
                    "init": "1"
                  }
                ],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 51,
                      "stmt": "{ DEBUG(\"inner\"); DEBUG_DUMP_STACK(); RETURN(); }"
                    }
                  }
                ]
              }
            },
            "main": {
              "line": 29,
              "body": {
                "line": 29,
                "vars": [
                  {
                    "line": 30,
                    "name": "a",
                    "type": "TODO(dkorolev): Implement this.",
                    "init": "1"
                  }
                ],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 35,
                      "stmt": "{ DEBUG(\"begin\"); DEBUG_DUMP_STACK(); NEXT(); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 38,
                      "stmt": "{ CALL(inner); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 43,
                      "stmt": "{ DEBUG(\"end\"); DEBUG_DUMP_STACK(); DONE(); }"
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "call_not_ok_to_fail_to_provide_result": {
      "line": 98,
      "fibers": {
        "call": {
          "line": 99,
          "functions": {
            "bar": {
              "line": 109,
              "body": {
                "line": 109,
                "vars": [],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 112,
                      "stmt": "{ RETURN(); }"
                    }
                  }
                ]
              }
            },
            "main": {
              "line": 100,
              "body": {
                "line": 100,
                "vars": [
                  {
                    "line": 101,
                    "name": "a",
                    "type": "TODO(dkorolev): Implement this.",
                    "init": "0"
                  }
                ],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 104,
                      "stmt": "{ CALL(a, bar); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 107,
                      "stmt": "{ DONE(); }"
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "call_ok_to_ignore_result": {
      "line": 80,
      "fibers": {
        "call": {
          "line": 81,
          "functions": {
            "foo": {
              "line": 90,
              "body": {
                "line": 90,
                "vars": [],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 93,
                      "stmt": "{ RETURN(1); }"
                    }
                  }
                ]
              }
            },
            "main": {
              "line": 82,
              "body": {
                "line": 82,
                "vars": [],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 85,
                      "stmt": "{ CALL(foo); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 88,
                      "stmt": "{ DONE(); }"
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "call_smoke": {
      "line": 3,
      "fibers": {
        "call": {
          "line": 4,
          "functions": {
            "inner": {
              "line": 18,
              "body": {
                "line": 18,
                "vars": [],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 22,
                      "stmt": "{ DEBUG(\"inner\"); RETURN(); }"
                    }
                  }
                ]
              }
            },
            "main": {
              "line": 5,
              "body": {
                "line": 5,
                "vars": [],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 9,
                      "stmt": "{ DEBUG(\"begin\"); NEXT(); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 12,
                      "stmt": "{ CALL(inner); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 16,
                      "stmt": "{ DEBUG(\"end\"); DONE(); }"
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "call_with_return": {
      "line": 56,
      "fibers": {
        "call": {
          "line": 57,
          "functions": {
            "main": {
              "line": 58,
              "body": {
                "line": 58,
                "vars": [
                  {
                    "line": 59,
                    "name": "a",
                    "type": "TODO(dkorolev): Implement this.",
                    "init": "0"
                  }
                ],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 63,
                      "stmt": "{ DEBUG_EXPR(a); NEXT(); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 66,
                      "stmt": "{ CALL(a, one); }"
                    }
                  },
                  {
                    "MaroonIRStmt": {
                      "line": 70,
                      "stmt": "{ DEBUG_EXPR(a); DONE(); }"
                    }
                  }
                ]
              }
            },
            "one": {
              "line": 72,
              "body": {
                "line": 72,
                "vars": [],
                "code": [
                  {
                    "MaroonIRStmt": {
                      "line": 75,
                      "stmt": "{ RETURN(1); }"
                    }
                  }
                ]
              }
            }
          }
        }
      }
    }
  },
  "tests": [
    {
      "MaroonTestCaseRunFiber": {
        "line": 124,
        "maroon": "call_smoke",
        "fiber": "call",
        "golden_output": [
          "begin",
          "inner",
          "end"
        ]
      }
    },
    {
      "MaroonTestCaseRunFiber": {
        "line": 129,
        "maroon": "call_dump",
        "fiber": "call",
        "golden_output": [
          "begin",
          "<[a:1]>",
          "inner",
          "<[a:1],inner@[b:1]>",
          "end",
          "<[a:1]>"
        ]
      }
    },
    {
      "MaroonTestCaseRunFiber": {
        "line": 134,
        "maroon": "call_with_return",
        "fiber": "call",
        "golden_output": [
          "a=0",
          "a=1"
        ]
      }
    },
    {
      "MaroonTestCaseRunFiber": {
        "line": 139,
        "maroon": "call_ok_to_ignore_result",
        "fiber": "call",
        "golden_output": []
      }
    },
    {
      "MaroonTestCaseFiberShouldThrow": {
        "line": 144,
        "maroon": "call_not_ok_to_fail_to_provide_result",
        "fiber": "call",
        "error": "A return value must have been provided."
      }
    }
  ]
}
